---
layout: post
title:  "家庭云搭建与应用"
author: kevin
categories: nas
tags: NAS
excerpt: 
---
* content
{:toc}


#### 前言
曾经被百度云的限速恶心过，被手机数据丢失恐惧过，被MBP空间不够烦恼过。正巧为了看世界杯购买的1080p投影也需要一个展示平台，而蓝光和1080p的片源也要求有大存储空间。

或许，是时候搭建个NAS解决问题了。

#### 装备
考虑过自行组装，也想过黑群等，功耗和稳定性是个问题。或许如果再年轻几岁，还有精力整这些，现在的我。。咳。
* NAS：正逢京东QNAP TS453B-mini有不错的价格，拿下。  
* 硬盘：原淘汰的PC还有一块1TB的硬盘，拆下来继续服役，另外新购3块4T红盘。   
* 路由： 对于NAS而言，一个好的千M路由必不可少，不过之前在用的华硕AC1900p还是能轻松应对。
* 高清播放：原本购买的小米盒子4，在播放1080p时卡出翔。看其他人评价，入了zidoo x9s。

#### 应用

##### 家庭影院

其它谈不上影院，因为音响欠缺较多，目前在使用创新的声霸锣蓝牙音箱，暂时感觉效果还行。后续继续折腾可能要考虑音响布局。不过目前在卧室看起来还是有点私人影院之感觉的：P

设备前面说了，这里说点其它。

**关于网络**  
因为NAS在书房，而投影及高清盒子在卧室，相距一堵墙并且不好走线，所以对无线网络要求较高，分别测试2.4G/5G下的下载速度。使用我的mbp通过scp命令拉取上面某个500M的文件，分别在书房和卧室测试数据。

书房（近路由1米内）：
5G:  100%  500MB  69.9MB/s   00:07
2.4G: 100%  500MB  14.5MB/s   00:34

卧室（远路由1堵墙，3米+）：
5G: 44%  221MB 698.5KB/s   06:49
2.4G: 100%  500MB  16.5MB/s   00:30

可见5G在这种情况下慢得惊人，2.4G还保持和原速度差不多，无明显衰减。

使用iphone8p手机实测2.4G，从NAS拉文件大概11-12Mb/s。这个速度对比网上找到的信息：
![Alt text](./assets/201808/nas_bitrate.png)
可见使用2.4G网络看高码率的1080p没问题，看极高码率的可能会卡顿。

**关于片源**  
* 现在主流的盒子都有手机投屏等，所以利用投屏将其它设备的视频串至盒子输出至投影即可。
* 既然上了NAS，不去自己下载超清就暴殄天物了。这时去混个好的PT站就比较重要了。注意下载的视频编码，如果盒子支持h265则优先下载，文件比h264的小很多，而且播放的码率也小很多，网络友好啊！（注x265,x264是其编码协议的具体实现）

**关于下载**  
开始使用Transmission自带的web ui一阵子，在配置好路由的端口映射等后，远程下载也是挺爽的事情。不过原生的gui实在难看，可以换一波，支持各PT站分类等。
![Alt text](./assets/201808/nas_transmission_webui.png)

因为使用的Qnap，这个ui的[官方版本](https://github.com/ronggang/transmission-web-control)不直接支持，需要修改些代码，我fork了后改了两点，可以从[这里](https://github.com/kevin1sMe/transmission-web-control)取到。
* Qnap不使用root，对user的校验增加了admin
* wget在github拉数据时已经旧的SSLv2，SSLv3好像都不行了，这里修改为TLSv1_2。

##### 私人云盘
Qnap提供了Qsync的各个版本，支持mac，win，手机上也有Qfile可以查看。
因深度与系统的资源管理explore或finder集成，使用云盘也比较简单，在各台设备上同步文件相当快。

##### 重要存储
NAS中我使用了两块4T盘做了RAID1(好浪费啊！)来保存认为重要的数据。
* 对于其它设备带来的数据，如下载的重要文件，珍贵视频或照片等，我们需要更好的保存。同样可以在使用`Qsync`或者直接ftp/nfs/samba等来存取。
* 手机的资料备份， 一般主要是照片，联系人，视频等，这块有专门软件可以做。官方有[推荐](https://www.qnap.com/static/landing/2017/en-qnap-nas-with-acronis-mobile/zh-tw/index.html)。 在手机和NAS中安装Acronis Mobile即可。

##### 邮件代理
之前注册的一大堆邮箱，长期不登陆有时错过有用的通知或消息，NAS的邮件应用`QmailAgent` 除了把邮件本地保存外，它的聚合能力配合手机端`QmailClient`，也是不错的解决方案。


暂时就这些，后续还有其它应用再更新本文。

